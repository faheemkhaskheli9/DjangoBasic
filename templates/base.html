{% load static %}
<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}MyProject{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'styles.css' %}">
</head>

<body>
  <header class="site-header">
    <a class="brand" href="{% url 'profiles:me' %}">
      <svg class="logo" viewBox="0 0 24 24" aria-hidden="true">
        <circle cx="12" cy="12" r="10" />
        <path d="M7 13l3 3 7-7" />
      </svg>
      <span>MyProject</span>
    </a>

    <nav class="nav">
      <!-- templates/base.html (inside <nav class="nav">) -->
      <a href="{% url 'messaging:inbox' %}">Messages
        <span id="unread-badge" class="badge" style="display:none;">0</span>
      </a>
      {% if user.is_authenticated %}
      <script>
        (function () {
          function refreshUnread() {
            fetch("{% url 'messaging:unread_count' %}", { credentials: "same-origin" })
              .then(r => r.json())
              .then(d => {
                const b = document.getElementById("unread-badge");
                if (!b) return;
                b.textContent = d.unread;
                b.style.display = d.unread > 0 ? "inline-block" : "none";
              }).catch(() => { });
          }
          refreshUnread();
          setInterval(refreshUnread, 20000); // every 20s
        })();
      </script>
      {% endif %}

      {% if user.is_authenticated %}
      <a href="{% url 'profiles:me' %}">Profile</a>
      <a href="{% url 'profiles:edit' %}">Edit</a>
      <form method="post" action="{% url 'users:logout' %}" class="logout-form">
        {% csrf_token %}
        <button type="submit" class="btn btn-ghost">Logout</button>
      </form>
      {% else %}
      <a href="{% url 'users:login' %}">Login</a>
      <a class="btn btn-primary" href="{% url 'users:signup' %}">Sign Up</a>
      {% endif %}
    </nav>
  </header>

  <main class="container">
    {% include "partials/messages.html" %}
    {% block content %}{% endblock %}
  </main>

  <footer class="site-footer">
    <p>Â© {% now "Y" %} MyProject</p>
  </footer>
</body>

</html>